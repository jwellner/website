box: devillex/docker-firebase:slim

build:
  steps:
    - script:
        name: test permissions
        code: |
          mkdir -p $WERCKER_ROOT/node_modules
          chmod -R 777 $WERCKER_ROOT/node_modules
          echo "$(ls -l $WERCKER_ROOT)"

    - npm-install
    - script:
        name: rebuild node-sass
        code: |
          chmod -R 777 $WERCKER_ROOT/node_modules/node-sass
          npm rebuild node-sass

    - hgen/gulp:
        tasks: build

    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"

deploy:
  steps:
      - michilu/gcs-website-deploy:
        bucket: www.wllnr.nl
        project: $GOOGLE_PROJECT_ID
        token: $GOOGLE_REFRESH_TOKEN
        dir: build

deploy-firebase:
  steps:
    - devillex/firebase-deploy@1.2.0:
        project: $FIREBASE_PROJECT
        token: $FIREBASE_TOKEN
        message: "Wercker deploy"
